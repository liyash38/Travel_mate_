<?php
session_start();

/* ==================== SEND OTP ==================== */
if(isset($_GET['send_otp']) && !empty($_GET['email'])){
    $email = $_GET['email'];
    $otp = rand(100000, 999999); // 6-digit OTP

    $_SESSION['otp'] = $otp;
    $_SESSION['email'] = $email;
    $_SESSION['otp_time'] = time(); // for optional expiry

    // Demo: show OTP on screen
    $info = "OTP sent successfully (Demo OTP: $otp)";
}

/* ==================== VERIFY OTP ==================== */
if(isset($_GET['verify_otp']) && !empty($_GET['otp'])){
    $entered_otp = $_GET['otp'];

    if(isset($_SESSION['otp'])){
        // Optional: OTP expires in 5 minutes (300 seconds)
        if(time() - $_SESSION['otp_time'] > 300){
            $error = "OTP expired! Please request again.";
            unset($_SESSION['otp']);
        } else if($entered_otp == $_SESSION['otp']){
            $_SESSION['loggedin'] = true;
            unset($_SESSION['otp']); // remove OTP after success
        } else {
            $error = "Invalid OTP!";
        }
    } else {
        $error = "Please request OTP first!";
    }
}

/* ==================== LOGOUT ==================== */
if(isset($_GET['logout'])){
    session_destroy();
    header("Location:index.php");
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Travel Mate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Segoe UI}
body{background:#f4f6f8;margin:0}

/* LOGIN PAGE */
.login-box{
 width:350px;
 background:white;
 padding:25px;
 margin:120px auto;
 border-radius:12px;
 box-shadow:0 10px 25px rgba(0,0,0,.2);
 text-align:center;
}
input,button{
 width:100%;
 padding:10px;
 margin:10px 0;
}
button{
 background:#002b5b;
 color:white;
 border:none;
 cursor:pointer;
}
.success{color:green}
.error{color:red}

/* WEBSITE VIEW */
nav{
 background:#002b5b;color:white;
 display:flex;justify-content:space-between;
 padding:15px 30px;
}
nav h2{color:#ffcc00}
nav a{color:white;margin-left:20px;text-decoration:none}
.hero{
 background:url("background.jpg") center/cover;
 height:80vh;display:flex;align-items:center;justify-content:center;
 color:white;text-align:center;
}
.container{max-width:1100px;margin:auto;padding:40px}
footer{background:#002b5b;color:white;text-align:center;padding:15px}
.logout{background:red;padding:6px 12px}
</style>
</head>
<body>

<?php if(!isset($_SESSION['loggedin'])){ ?>

<!-- ================= LOGIN PAGE ================= -->
<div class="login-box">
<h2>Email Login</h2>

<?php if(!isset($_SESSION['otp'])){ ?>
<form method="get">
<input type="email" name="email" placeholder="Enter Email ID" required>
<button type="submit" name="send_otp" value="1">Send OTP</button>
</form>
<p class="success"><?php if(isset($info)) echo $info; ?></p>

<?php } else { ?>
<form method="get">
<input type="number" name="otp" placeholder="Enter OTP" required>
<button type="submit" name="verify_otp" value="1">Verify OTP</button>
</form>
<p class="error"><?php if(isset($error)) echo $error; ?></p>
<p><a href="index.php">Resend OTP</a></p>
<?php } ?>

</div>

<?php } else { ?>

<!-- ================= HOME PAGE ================= -->
<nav>
<h2>Travel Mate</h2>
<div>
<a href="#packages">Packages</a>
<a href="#reviews">Reviews</a>
<a href="#booking">Booking</a>
<a href="?logout=true" class="logout">Logout</a>
</div>
</nav>

<div class="hero">
<div>
<h1 style="color:#250430">Explore the World with Us</h1>
<p style="color: rgb(41, 2, 29)">India's Trusted Holiday Partner</p>
</div>
</div>

<div class="container">
<h2>Welcome ðŸŽ‰</h2>
<p>Email ID: <?php echo $_SESSION['email']; ?></p>
<p>OTP verified login successful.</p>

<!-- Example: Add Review Button -->
<p><a href="#reviews" style="background:#002b5b;color:white;padding:8px 15px;border-radius:5px;text-decoration:none;">My Review</a></p>

</div>

<footer>
<p>Â© 2026 Travel Mate | Big Project</p>
</footer>

<?php } ?>

</body>
</html>
